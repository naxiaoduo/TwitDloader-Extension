const i18n = {
    'zh-CN': {
        parseButton: '解析推文',
        showPageButton: '在页面显示解析按钮',
        settings: '设置',
        relatedWebsite: '相关网站',
        sponsor: '赞助我们',
        apiSettings: 'API 设置',
        interfaceLanguage: '界面语言',
        parseApiUrl: '解析 API URL',
        themeSettings: '主题设置',
        themeColor: '主题颜色',
        saveSettings: '保存设置',
        settingsSaved: '设置已保存',
        twitterBlue: 'Twitter蓝',
        vitalityRed: '活力红',
        freshGreen: '清新绿',
        sunshineYellow: '阳光黄',
        useOnTwitter: '请在Twitter/X页面使用此扩展',
        pageParseButton: '解析推文'
    },
    'zh-TW': {
        parseButton: '解析推文',
        showPageButton: '在頁面顯示解析按鈕',
        settings: '設置',
        relatedWebsite: '相關網站',
        sponsor: '贊助我們',
        apiSettings: 'API 設置',
        interfaceLanguage: '界面語言',
        parseApiUrl: '解析 API URL',
        themeSettings: '主題設置',
        themeColor: '主題顏色',
        saveSettings: '保存設置',
        settingsSaved: '設置已保存',
        twitterBlue: 'Twitter藍',
        vitalityRed: '活力紅',
        freshGreen: '清新綠',
        sunshineYellow: '陽光黃',
        useOnTwitter: '請在Twitter/X頁面使用此擴展',
        pageParseButton: '解析推文'
    },
    'en': {
        parseButton: 'Parse Tweet',
        showPageButton: 'Show Parse Button on Page',
        settings: 'Settings',
        relatedWebsite: 'Related Website',
        sponsor: 'Sponsor Us',
        apiSettings: 'API Settings',
        interfaceLanguage: 'Interface Language',
        parseApiUrl: 'Parse API URL',
        themeSettings: 'Theme Settings',
        themeColor: 'Theme Color',
        saveSettings: 'Save Settings',
        settingsSaved: 'Settings Saved',
        twitterBlue: 'Twitter Blue',
        vitalityRed: 'Vitality Red',
        freshGreen: 'Fresh Green',
        sunshineYellow: 'Sunshine Yellow',
        useOnTwitter: 'Please use this extension on Twitter/X page',
        pageParseButton: 'Parse Tweet'
    },
    'ja': {
        parseButton: 'ツイートを解析',
        showPageButton: 'ページに解析ボタンを表示',
        settings: '設定',
        relatedWebsite: '関連サイト',
        sponsor: '支援する',
        apiSettings: 'API設定',
        interfaceLanguage: 'インターフェース言語',
        parseApiUrl: '解析API URL',
        themeSettings: 'テーマ設定',
        themeColor: 'テーマカラー',
        saveSettings: '設定を保存',
        settingsSaved: '設定が保存されました',
        twitterBlue: 'Twitterブルー',
        vitalityRed: 'バイタリティレッド',
        freshGreen: 'フレッシュグリーン',
        sunshineYellow: 'サンシャインイエロー',
        useOnTwitter: 'Twitter/Xページで使用してください',
        pageParseButton: 'ツイートを解析'
    },
    'ko': {
        parseButton: '트윗 분석',
        showPageButton: '페이지에 분석 버튼 표시',
        settings: '설정',
        relatedWebsite: '관련 웹사이트',
        sponsor: '후원하기',
        apiSettings: 'API 설정',
        interfaceLanguage: '인터페이스 언어',
        parseApiUrl: '분석 API URL',
        themeSettings: '테마 설정',
        themeColor: '테마 색상',
        saveSettings: '설정 저장',
        settingsSaved: '설정이 저장되었습니다',
        twitterBlue: '트위터 블루',
        vitalityRed: '활력 레드',
        freshGreen: '프레시 그린',
        sunshineYellow: '선샤인 옐로우',
        useOnTwitter: 'Twitter/X 페이지에서 사용해주세요',
        pageParseButton: '트윗 분석'
    },
    'ru': {
        parseButton: 'Анализ твита',
        showPageButton: 'Показать кнопку анализа на странице',
        settings: 'Настройки',
        relatedWebsite: 'Связанный сайт',
        sponsor: 'Поддержать нас',
        apiSettings: 'Настройки API',
        interfaceLanguage: 'Язык интерфейса',
        parseApiUrl: 'URL API анализа',
        themeSettings: 'Настройки темы',
        themeColor: 'Цвет темы',
        saveSettings: 'Сохранить настройки',
        settingsSaved: 'Настройки сохранены',
        twitterBlue: 'Twitter синий',
        vitalityRed: 'Живой красный',
        freshGreen: 'Свежий зеленый',
        sunshineYellow: 'Солнечный желтый',
        useOnTwitter: 'Используйте это расширение на странице Twitter/X',
        pageParseButton: 'Анализ твита'
    },
    'ar': {
        parseButton: 'تحليل التغريدة',
        showPageButton: 'إظهار زر التحليل في الصفحة',
        settings: 'الإعدادات',
        relatedWebsite: 'الموقع ذو الصلة',
        sponsor: 'ادعمنا',
        apiSettings: 'إعدادات API',
        interfaceLanguage: 'لغة الواجهة',
        parseApiUrl: 'رابط API التحليل',
        themeSettings: 'إعدادات المظهر',
        themeColor: 'لون المظهر',
        saveSettings: 'حفظ الإعدادات',
        settingsSaved: 'تم حفظ الإعدادات',
        twitterBlue: 'أزرق تويتر',
        vitalityRed: 'أحمر حيوي',
        freshGreen: 'أخضر منعش',
        sunshineYellow: 'أصفر مشمس',
        useOnTwitter: 'يرجى استخدام هذا الامتداد على صفحة Twitter/X',
        pageParseButton: 'تحليل التغريدة'
    },
    'fa': {
        parseButton: 'تجزیه توییت',
        showPageButton: 'نمایش دکمه تجزیه در صفحه',
        settings: 'تنظیمات',
        relatedWebsite: 'وبسایت مرتبط',
        sponsor: 'حمایت از ما',
        apiSettings: 'تنظیمات API',
        interfaceLanguage: 'زبان رابط',
        parseApiUrl: 'آدرس API تجزیه',
        themeSettings: 'تنظیمات پوسته',
        themeColor: 'رنگ پوسته',
        saveSettings: 'ذخیره تنظیمات',
        settingsSaved: 'تنظیمات ذخیره شد',
        twitterBlue: 'آبی توییتر',
        vitalityRed: 'قرمز پرانرژی',
        freshGreen: 'سبز تازه',
        sunshineYellow: 'زرد آفتابی',
        useOnTwitter: 'لطفاً این افزونه را در صفحه Twitter/X استفاده کنید',
        pageParseButton: 'تجزیه توییت'
    },
    'fr': {
        parseButton: 'Analyser le tweet',
        showPageButton: 'Afficher le bouton d\'analyse sur la page',
        settings: 'Paramètres',
        relatedWebsite: 'Site associé',
        sponsor: 'Nous soutenir',
        apiSettings: 'Paramètres API',
        interfaceLanguage: 'Langue de l\'interface',
        parseApiUrl: 'URL de l\'API d\'analyse',
        themeSettings: 'Paramètres du thème',
        themeColor: 'Couleur du thème',
        saveSettings: 'Enregistrer les paramètres',
        settingsSaved: 'Paramètres enregistrés',
        twitterBlue: 'Bleu Twitter',
        vitalityRed: 'Rouge vitalité',
        freshGreen: 'Vert frais',
        sunshineYellow: 'Jaune soleil',
        useOnTwitter: 'Veuillez utiliser cette extension sur la page Twitter/X',
        pageParseButton: 'Analyser le tweet'
    },
    'es': {
        parseButton: 'Analizar tweet',
        showPageButton: 'Mostrar botón de análisis en la página',
        settings: 'Configuración',
        relatedWebsite: 'Sitio relacionado',
        sponsor: 'Apóyanos',
        apiSettings: 'Configuración de API',
        interfaceLanguage: 'Idioma de la interfaz',
        parseApiUrl: 'URL de API de análisis',
        themeSettings: 'Configuración del tema',
        themeColor: 'Color del tema',
        saveSettings: 'Guardar configuración',
        settingsSaved: 'Configuración guardada',
        twitterBlue: 'Azul Twitter',
        vitalityRed: 'Rojo vitalidad',
        freshGreen: 'Verde fresco',
        sunshineYellow: 'Amarillo sol',
        useOnTwitter: 'Por favor, use esta extensión en la página de Twitter/X',
        pageParseButton: 'Analizar tweet'
    },
    'pt': {
        parseButton: 'Analisar tweet',
        showPageButton: 'Mostrar botão de análise na página',
        settings: 'Configurações',
        relatedWebsite: 'Site relacionado',
        sponsor: 'Apoie-nos',
        apiSettings: 'Configurações da API',
        interfaceLanguage: 'Idioma da interface',
        parseApiUrl: 'URL da API de análise',
        themeSettings: 'Configurações do tema',
        themeColor: 'Cor do tema',
        saveSettings: 'Salvar configurações',
        settingsSaved: 'Configurações salvas',
        twitterBlue: 'Azul Twitter',
        vitalityRed: 'Vermelho vitalidade',
        freshGreen: 'Verde fresco',
        sunshineYellow: 'Amarelo sol',
        useOnTwitter: 'Por favor, use esta extensão na página do Twitter/X',
        pageParseButton: 'Analisar tweet'
    }
};

async function getCurrentLanguage() {
    try {
        const data = await chrome.storage.sync.get('language');
        if (data.language) {
            return data.language;
        }

        // 获取浏览器语言
        const browserLang = navigator.language || navigator.userLanguage;
        
        // 首先尝试完整的语言代码匹配（例如 zh-CN）
        if (i18n[browserLang]) {
            // 保存检测到的语言，这样下次就会直接使用
            await chrome.storage.sync.set({ language: browserLang });
            return browserLang;
        }
        
        // 然后尝试基础语言代码匹配（例如 zh）
        const langCode = browserLang.split('-')[0];
        if (i18n[langCode]) {
            await chrome.storage.sync.set({ language: langCode });
            return langCode;
        }
        
        // 对于中文特殊处理
        if (langCode === 'zh') {
            // 如果是中文，默认使用简体中文
            await chrome.storage.sync.set({ language: 'zh-CN' });
            return 'zh-CN';
        }
        
        // 如果都不匹配，默认使用英文
        await chrome.storage.sync.set({ language: 'en' });
        return 'en';
    } catch (error) {
        console.error('Error getting language:', error);
        return 'en';
    }
}

function getMessage(key) {
    return getCurrentLanguage().then(lang => {
        return i18n[lang]?.[key] || i18n['en'][key];
    });
}

// 修改初始化函数，使其返回 Promise
async function initializeI18n() {
    try {
        const elements = document.querySelectorAll('[data-i18n]');
        for (const element of elements) {
            const key = element.getAttribute('data-i18n');
            const text = await getMessage(key);
            if (element.tagName === 'INPUT' && element.type === 'placeholder') {
                element.placeholder = text;
            } else {
                element.textContent = text;
            }
        }
    } catch (error) {
        console.error('Error initializing i18n:', error);
    }
} 